{% assign current_lang = page.lang | default: nil %}

{% if current_lang == nil %}
  {% if page.url contains '/fr/' or page.url == '/fr' %}
    {% assign current_lang = 'fr' %}
  {% elsif page.url contains '/es/' or page.url == '/es' %}
    {% assign current_lang = 'es' %}
  {% else %}
    {% assign current_lang = 'en' %}
  {% endif %}
{% endif %}

{% assign lang_prefix = '' %}
{% if current_lang == 'fr' %}
  {% assign lang_prefix = '/fr' %}
{% elsif current_lang == 'es' %}
  {% assign lang_prefix = '/es' %}
{% endif %}

{% assign home_url = '/' %}
{% if current_lang == 'fr' %}
  {% assign home_url = '/fr/' %}
{% elsif current_lang == 'es' %}
  {% assign home_url = '/es/' %}
{% endif %}

{% assign t = site.data.translations[current_lang] %}

{% comment %} Generate hreflang URLs {% endcomment %}
{% assign base_path = page.url | remove_first: '/fr' | remove_first: '/es' %}
{% assign base_url = site.url | append: site.baseurl %}
{% assign url_en = base_url | append: base_path %}
{% assign url_fr = base_url | append: '/fr' | append: base_path %}
{% assign url_es = base_url | append: '/es' | append: base_path %}

<!DOCTYPE html>
<html lang="{{ current_lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title | default: site.title }}</title>
    <meta name="description" content="{{ page.description | default: site.description }}">

    {% comment %} hreflang tags for SEO {% endcomment %}
    <link rel="alternate" hreflang="en" href="{{ url_en }}" />
    <link rel="alternate" hreflang="fr" href="{{ url_fr }}" />
    <link rel="alternate" hreflang="es" href="{{ url_es }}" />
    <link rel="alternate" hreflang="x-default" href="{{ url_en }}" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

    <link href="{{ '/assets/bootstrap.min.css' | relative_url }}" rel="stylesheet">
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
</head>

<body>

<nav class="navbar navbar-expand-lg navbar-transparent{% if page.navbar_class %} {{ page.navbar_class }}{% endif %}">
    <div class="container container-wide">

        <!-- LOGO: FIXED -->
        <a class="navbar-brand fw-bold" href="{{ home_url | relative_url }}">
            <img src="{{ '/assets/images/00_eDNA logo.svg' | relative_url }}" class="img-fluid" alt="" style="height: 48px;">
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">

                <li class="nav-item">
                    <a class="nav-link" href="{{ lang_prefix }}/jointheproject">{{ t.nav.join_project }}</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="{{ lang_prefix }}/whoweare">{{ t.nav.who_we_are }}</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="{{ lang_prefix }}/resources">{{ t.nav.resources }}</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="{{ '/faq' | relative_url }}">FAQ</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="{{ lang_prefix }}/contact">{{ t.nav.contact }}</a>
                </li>

                <!-- LANGUAGE DROPDOWN: OG BEHAVIOUR -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="languageDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        {{ t.lang[current_lang] }}
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
                        {% assign base_url = page.url | remove_first: '/fr' | remove_first: '/es' %}
                        <li>
                          <a class="dropdown-item{% if current_lang == 'en' %} active{% endif %}" href="{{ base_url }}">
                            {{ site.data.translations.en.lang.en }}
                          </a>
                        </li>
                        <li>
                          <a class="dropdown-item{% if current_lang == 'fr' %} active{% endif %}" href="/fr{{ base_url }}">
                            {{ site.data.translations.fr.lang.fr }}
                          </a>
                        </li>
                        <li>
                          <a class="dropdown-item{% if current_lang == 'es' %} active{% endif %}" href="/es{{ base_url }}">
                            {{ site.data.translations.es.lang.es }}
                          </a>
                        </li>
                    </ul>
                </li>

            </ul>
        </div>
    </div>
</nav>

{{ content }}

<footer class="edna-footer" role="contentinfo">
  <div class="container container-wide py-5">
    <div class="edna-footer__grid">

      <div class="edna-footer__left">
        <!-- FOOTER LOGO: FIXED -->
        <a href="{{ home_url | relative_url }}" class="edna-footer__brand" aria-label="eDNA Expeditions home">
          <img
            src="{{ '/assets/images/00_eDNA logo.svg' | relative_url }}"
            alt="eDNA Expeditions"
            class="edna-footer__logo img-fluid">
        </a>
      </div>

      <div class="edna-footer__right">
        {{ t.footer.description }}
      </div>

    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
